<?php

if(isset($_GET['sleep'])){
    sleep($_GET['sleep']);
    die();
}
?>
<!DOCTYPE html>
<html>
<head>
    <base href="/">
    <title>Node PHP Awesome Server</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <?php if (isset($_SERVER['LIVERELOAD'])): ?>
        <script src="http://localhost:<?php echo $_SERVER['LIVERELOAD'] ?>/livereload.js"></script>
        <?php else: ?>
        <link rel="stylesheet" href="style.css" />
    <?php endif ?>
</head>
<?php

$theme = "php";

if (isset($_SERVER['NODE_NPAS_OPTIONS']['theme'])) {

    $t = $_SERVER['NODE_NPAS_OPTIONS']['theme'];

    if (in_array(strtolower($t), array('php', 'angular', 'react', 'codeigniter'))) {

        $theme = $t;

        if ($theme == 'php' && substr(phpversion(), 0, 1) == '7') {
            $theme = 'php7';
        }

    }

}

?>
<body class="<?php echo $theme ?>-theme">
<?php

$gatherVariables = array();
foreach ($_SERVER as $k => $v) {
    if (strstr($k, 'NODE_') || strstr($k, 'HTTP_NPAS')) {
        $gatherVariables[$k] = $v;
    }
}
?>

<?php if (getenv('npasRouterError') !== FALSE): ?>

    <div class="error">

        <div class="title">Invalid Router file</div>
        <div class="message">
            <?php echo getenv('npasRouterError') ?>
        </div>

    </div>

<?php endif ?>
<node-php-awesome-server id="npas-globals" data-global-variables='<?php echo json_encode($gatherVariables) ?>'>
    Loading...
</node-php-awesome-server>
<script type="application/javascript" src="polyfills.bundle.js"></script>
<script type="application/javascript" src="vendor.bundle.js"></script>
<script type="application/javascript" src="app.bundle.js"></script>
</body>
</html>
