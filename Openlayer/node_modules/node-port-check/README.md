# Node Port Check


Check if a TCP port is in use and tries to return an incremented 
version of your port if it's found available.

# Options
**Options** | **Default Values** | **Description**
------- | -------------- | -----------
host | 0.0.0.0 | IP address
port | 80 | number or an array of numbers
output | false | Shows output if 'true'
maxRetries | 10 | 0 - no retries

# Demos

### Example 1 - Simple

```javascript
/**
 * Demo use case:
 *  We'll bind ports 3010 and 3011 with mockServer
 *  Since we have maxRetries = 3 in the 'yourConfig', it will increment the config port 3 times
 *  and check the availability for ports 3010, 3011 and 3012
 *  the returning port will be 3012 ( assuming you don't have that port bound by another application )
 *
 *  #1 - this lines won't exist in your code, their purpose it's just for testing
 */
let mockServer = require('./mockServer.js'); // #1
mockServer(3010); // #1
mockServer(3011); // #1

/**
 * EXAMPLE 1
 */
let NodePortCheck = require('node-port-check');

let yourConfig = {
    host: '0.0.0.0',
    port: 3010,
    output: true,
    maxRetries: 3
};

NodePortCheck(yourConfig, (isPortAvailable, availablePort, initialPort) => {

    console.log('');

    if (isPortAvailable) {

        console.log('Available port:', availablePort);

    } else {

        console.log('Port is not available, last tried port was', availablePort);

    }

    console.log('Your config port/s:', initialPort);

    process.exit(0);

});
```

**Output:**
```
Mock Server started on port 3010
Mock Server started on port 3011
Server retry attempt #1 at 0.0.0.0:3011
Server retry attempt #2 at 0.0.0.0:3012
Server bound to 0.0.0.0:3012
Server closed - port released - done

Available port: 3012
Your config port/s: 3010
```


### Example 2 - Multiple Ports

```javascript
/**
 * Demo use case:
 *  We'll bind ports 3010, 4500 and 9921 with mockServer
 *  Since we have maxRetries = 0 now in 'yourConfig' no incrementation will be done ( see example 3 for multiple ports and maxRetries > 0 )
 *  the returning port will be the first encountered free port, that is 5195
 *  ( assuming you don't have that port bound by another application )
 *
 *  #1 - this lines won't exist in your code, their purpose it's just for testing
 */
let mockServer = require('./mockServer.js'); // #1
mockServer(3010); // #1
mockServer(4500); // #1
mockServer(9921); // #1

/**
 * EXAMPLE 2
 */
let NodePortCheck = require('node-port-check');

let yourConfig = {
    host: '0.0.0.0',
    port: [3010, 4500, 5195, 9921],
    output: true,
    maxRetries: 0
};

NodePortCheck(yourConfig, (isPortAvailable, availablePort, initialPort) => {

    console.log('');

    if (isPortAvailable) {

        console.log('Available port:', availablePort);

    } else {

        console.log('Port is not available, last tried port was', availablePort);

    }

    console.log('Your config port/s:', initialPort);

    process.exit(0);

});
```

**Output:**
```
Mock Server started on port 3010
Mock Server started on port 4500
Mock Server started on port 9921
Maximum retries were reached for port 3010
Maximum retries were reached for port 4500
Server bound to 0.0.0.0:5195
Server closed - port released - done

Available port: 5195
Your config port/s: [ 3010, 4500, 5195, 9921 ]
```

### Example 3 - Multiple Ports - Part 2

```javascript
/**
 * Demo use case:
 *  We won't need mockServer for this example
 *  Our host has changed into an invalid IP address '0.0.0.1'
 *  and we increased maxRetries to 3
 *  Due to an invalid IP address we'll have isPortAvailable always false
 *
 */

/**
 * EXAMPLE 3
 */
let NodePortCheck = require('node-port-check');

let yourConfig = {
    host: '0.0.0.1',
    port: [3010, 4500, 5195, 9921],
    output: true,
    maxRetries: 3
};

NodePortCheck(yourConfig, (isPortAvailable, availablePort) => {

    console.log('');

    if (isPortAvailable) {

        console.log('Available port:', availablePort);

    } else {

        console.log('Port is not available, last tried port was', availablePort);

    }

});
```

**Output:**
```
Server retry attempt #1 at 0.0.0.1:3011
Server retry attempt #2 at 0.0.0.1:3012
Server retry attempt #3 at 0.0.0.1:3013
Maximum retries were reached for port 3010
Server retry attempt #1 at 0.0.0.1:4501
Server retry attempt #2 at 0.0.0.1:4502
Server retry attempt #3 at 0.0.0.1:4503
Maximum retries were reached for port 4500
Server retry attempt #1 at 0.0.0.1:5196
Server retry attempt #2 at 0.0.0.1:5197
Server retry attempt #3 at 0.0.0.1:5198
Maximum retries were reached for port 5195
Server retry attempt #1 at 0.0.0.1:9922
Server retry attempt #2 at 0.0.0.1:9923
Server retry attempt #3 at 0.0.0.1:9924
Maximum retries were reached for port 9921

Port is not available, last tried port was 9924
```